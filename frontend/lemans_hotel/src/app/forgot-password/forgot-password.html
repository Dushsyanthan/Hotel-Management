<div class="forgot-container">
    <div class="forgot-card">
        <div class="forgot-header">
            <h1>Reset Password</h1>
            <p>
                @if (step === 1) {
                Enter your email to receive an OTP.
                } @else {
                Enter the OTP sent to your email and your new password.
                }
            </p>
        </div>

        @if (errorMessage) {
        <div class="error-banner">
            {{ errorMessage }}
        </div>
        }

        @if (successMessage) {
        <div class="success-banner">
            {{ successMessage }}
        </div>
        }

        @if (step === 1) {
        <form [formGroup]="emailForm" (ngSubmit)="sendOtp()" class="forgot-form">
            <div class="form-group">
                <label for="email">Email Address</label>
                <input type="email" id="email" formControlName="email" placeholder="Enter your email"
                    [class.error]="emailForm.get('email')?.invalid && emailForm.get('email')?.touched">
                @if (emailForm.get('email')?.invalid && emailForm.get('email')?.touched) {
                <span class="error-msg">Please enter a valid email.</span>
                }
            </div>

            <button type="submit" class="submit-btn" [disabled]="emailForm.invalid || loading">
                {{ loading ? 'Sending...' : 'Send OTP' }}
            </button>
        </form>
        } @else {
        <form [formGroup]="resetForm" (ngSubmit)="resetPassword()" class="forgot-form">
            <div class="form-group">
                <label for="otp">OTP Code</label>
                <input type="text" id="otp" formControlName="otp" placeholder="Enter OTP"
                    [class.error]="resetForm.get('otp')?.invalid && resetForm.get('otp')?.touched">
                @if (resetForm.get('otp')?.invalid && resetForm.get('otp')?.touched) {
                <span class="error-msg">OTP is required.</span>
                }
            </div>

            <div class="form-group">
                <label for="newPassword">New Password</label>
                <div class="password-input-wrapper">
                    <input [type]="showPassword ? 'text' : 'password'" id="newPassword" formControlName="newPassword"
                        placeholder="Enter new password"
                        [class.error]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched">
                    <button type="button" class="toggle-password" (click)="togglePassword()">
                        <span class="eye-icon">{{ showPassword ? 'ğŸ‘ï¸' : 'ğŸ‘ï¸â€ğŸ—¨ï¸' }}</span>
                    </button>
                </div>
                @if (resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched) {
                <span class="error-msg">Password must be at least 6 characters.</span>
                }
            </div>

            <button type="submit" class="submit-btn" [disabled]="resetForm.invalid || loading">
                {{ loading ? 'Resetting...' : 'Reset Password' }}
            </button>
        </form>
        }

        <div class="back-link">
            <a routerLink="/login">â† Back to Login</a>
        </div>
    </div>
</div>